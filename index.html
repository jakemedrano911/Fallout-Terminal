<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RobCo Engineering Division Database</title>
<style>
  @font-face{
    font-family:"Fixedsys Excelsior";
    src:url("fonts/FixedsysExcelsior.ttf") format("truetype"),
        local("Fixedsys Excelsior 3.01"), local("Fixedsys Excelsior"), local("FixedsysExcelsior");
    font-weight:normal;
    font-style:normal;
  }
  :root{
    --scale:clamp(0.7, min(100vw,100vh)/600, 3);
  }
  body{
    margin:0;
    background:#000;
    color:#7aff7a;
    font-family:"Fixedsys Excelsior","IBM Plex Mono",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;
    font-size:calc(24px * var(--scale));
    letter-spacing:calc(.25px * var(--scale));
    line-height:1.2;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    box-sizing:border-box;
    padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
  #terminal-wrapper{
    position:relative;
    width: clamp(300px, calc(600px * var(--scale)), 90vw);
    height: clamp(400px, calc(800px * var(--scale)), 90vh);
    max-width:90vw;
    max-height:90vh;
  }
  #power-screen{
    position:absolute;
    top:0;left:0;right:0;bottom:0;
    background:#000;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#7aff7a;
  }
  #terminal{
    position:relative;
    width:100%;
    height:100%;
    border:calc(4px * var(--scale)) solid #008800;
    box-sizing:border-box;
    padding:calc(10px * var(--scale));
    overflow:hidden;
    display:none;
    flex-direction:column;
    background:#041204;
    border-radius:calc(12px * var(--scale));
  }
  #terminal.powered{
    display:flex;
  }
  #power-container{
    position:absolute;
    bottom:0;
    right:0;
    display:flex;
    align-items:center;
    transform:translate(calc(20px * var(--scale)), calc(20px * var(--scale)));
  }
  #power-container span{
    color:#7aff7a;
    margin-right:calc(5px * var(--scale));
  }
  #power-button{
    background:#b3410e;
    color:#fff;
    border:calc(2px * var(--scale)) solid #008800;
    width:max(44px, calc(40px * var(--scale)));
    height:max(44px, calc(40px * var(--scale)));
    border-radius:0;
    font-size:calc(20px * var(--scale));
    cursor:pointer;
  }
  #audio-menu{
    position:absolute;
    bottom:0;
    left:0;
    display:none;
    transform:translate(calc(-20px * var(--scale)), calc(20px * var(--scale)));
  }
  #audio-toggle{
    background:#b3410e;
    color:#fff;
    border:calc(2px * var(--scale)) solid #008800;
    cursor:pointer;
    margin-bottom:calc(5px * var(--scale));
    padding:calc(5px * var(--scale));
    min-height:44px;
  }
  #volume-controls{
    display:none;
    background:#041204;
    border:calc(2px * var(--scale)) solid #008800;
    color:#7aff7a;
    padding:calc(5px * var(--scale));
  }
  #volume-controls label{
    display:flex;
    align-items:center;
    font-size:calc(12px * var(--scale));
    margin-right:calc(10px * var(--scale));
  }
  #volume-controls input[type=range]{
    margin-left:calc(5px * var(--scale));
  }
  #terminal::after{
    content:"";
    position:absolute;
    top:0;left:0;right:0;bottom:0;
    pointer-events:none;
    background:repeating-linear-gradient(
      rgba(0,0,0,0.15) 0px,
      rgba(0,0,0,0.15) 1px,
      transparent 1px,
      transparent 2px
    );
    border-radius:inherit;
    animation: roll 6s linear infinite;
  }
  @keyframes roll{
    from{background-position:0 0;}
    to{background-position:0 100%;}
  }
  #header, #content{
    white-space:pre-wrap;
  }
  #content{
    flex:1;
    overflow:auto;
    -webkit-overflow-scrolling:touch;
  }
  #input{
    white-space:pre-wrap;
    min-height:1.2em;
  }
  .option{
    display:flex;
    align-items:center;
    width:100%;
    cursor:pointer;
    padding:0 calc(4px * var(--scale));
    min-height:max(44px, calc(44px * var(--scale)));
  }
  .option:hover, .option:focus, .option.selected{
    background:#008800;
    color:#041204;
  }
  .cursor{display:inline-block; animation:blink 1s steps(1,end) infinite;}
  @keyframes blink{50%{opacity:0;}}
</style>
</head>
<body>
<div id="terminal-wrapper">
  <div id="power-screen">POWER OFF - PRESS POWER BUTTON</div>
  <div id="terminal">
    <div id="header"></div>
    <div id="content"></div>
    <div id="input"></div>
  </div>
  <div id="audio-menu">
    <button id="audio-toggle">Audio</button>
    <div id="volume-controls">
      <label>Hum <input type="range" min="1" max="10" value="2" id="hum-volume"></label>
      <label>Scroll <input type="range" min="1" max="10" value="5" id="scroll-volume"></label>
      <label>Focus <input type="range" min="1" max="10" value="5" id="focus-volume"></label>
      <label>Select <input type="range" min="1" max="10" value="5" id="select-volume"></label>
    </div>
  </div>
  <div id="power-container"><span>Power</span><button id="power-button" aria-label="Power">&#x23FB;</button></div>
</div>
<script>
const headerLines=[
"ROBCO INDUSTRIES UNIFIED OPERATING SYSTEM",
"COPYRIGHT 2075-2077 ROBCO INDUSTRIES",
"-Server 12-",
"",
"Welcome to the RobCo Engineering Division Database!",
"How may I assist you this fine day?",
"____________________________________________________",
"",
];

const screens={
  menu:[
    {text:"> Protectron Schematics",screen:"protectron"},
    {text:"> Mr. Handy Service Records",screen:"handy"},
    {text:"> Assaultron Combat Models",screen:"assaultron"},
    {text:"> Securitron Systems Control",screen:"securitron"},
    {text:"> Experimental Robotics Files",screen:"experimental"},
    "",
    ""
  ],
  protectron:[
    "== PROTECTRON SCHEMATICS ==",
    "",
    "Model: PRC-66b",
    "Design: Bipedal, steel-alloy frame",
    "Power Supply: Standard fission battery pack",
    "Primary Functions: Civil service, law enforcement, light labor",
    "Weapon Systems: Integrated laser emitter (calibrated for crowd control)",
    "",
    "WARNING: Protectron AI routines exhibit limited situational awareness.",
    "Recommend close oversight when deployed in mixed civilian environments.",
    "",
    {text:"> RETURN",screen:"menu"}
  ],
  handy:[
    "== MR. HANDY SERVICE RECORDS ==",
    "",
    "Unit: MH-13A",
    "Last Maintenance: 07/15/2076",
    "Notes: Coolant leak in upper thruster assembly. Patched with epoxy resin.",
    "Armament: Circular saw, extendable manipulator arms, standard flame nozzle",
    "Service Log: Unit has been reassigned to Vault facilities for sanitation and meal preparation.",
    "",
    "CAUTION: Mr. Handy flame module should NOT be operated in enclosed living quarters.",
    "",
    {text:"> RETURN",screen:"menu"}
  ],
  assaultron:[
    "== ASSAULTRON COMBAT MODELS ==",
    "",
    "Model: ATX-03",
    "Chassis: Lightweight, high-speed framework",
    "Power Supply: Enclave-enhanced microfusion cell",
    "Primary Armament: Integrated face-mounted laser array",
    "Secondary Armament: Retractable claw appendages",
    "Performance: Field trials confirm 95% neutralization efficiency against armed combatants.",
    "",
    "NOTE: Operators advised to maintain line-of-sight at all times.",
    "Unit will prioritize nearest hostile target without hesitation.",
    "",
    {text:"> RETURN",screen:"menu"}
  ],
  securitron:[
    "== SECURITRON SYSTEMS CONTROL ==",
    "",
    "Model: Series VII Securitron",
    "Current OS Build: 4.23b",
    "Weapon Systems: 9mm submachinegun, onboard grenade launcher, riot baton",
    "Patrol Pattern: Auto-routed grid cycle",
    "Override Protocol: Requires Overseer clearance code (SEC-PRIME)",
    "",
    "Systems stable. Last crash report: NONE.",
    "All Securitron units in storage. Awaiting deployment order.",
    "",
    {text:"> RETURN",screen:"menu"}
  ],
  experimental:[
    "== EXPERIMENTAL ROBOTICS FILES ==",
    "",
    "File: X9-Blackbird Initiative",
    "Contents: Prototype stealth reconnaissance platform",
    "Status: [REDACTED]",
    "Notes: Cloaking field unstable. High energy draw. Prolonged use risks catastrophic cell failure.",
    "",
    "File: Project REX",
    "Contents: Experimental human-robot neural integration",
    "Status: SUSPENDED",
    "Notes: Overseer authorization required. Do not disseminate.",
    "",
    "Unauthorized access to experimental files will result in TERMINATION OF CONTRACT.",
    "",
    {text:"> RETURN",screen:"menu"}
  ]
};

const terminal=document.getElementById('terminal');
const powerButton=document.getElementById('power-button');
const powerScreen=document.getElementById('power-screen');
const header=document.getElementById('header');
const content=document.getElementById('content');
const input=document.getElementById('input');
let currentOptions=[];
let selected=-1;
let typing=false;
let baseDelay=10;
let speed=1;
let inputText="";
let screenHistory=[];
let skipNextClick=false;
let powered=false;

const audioMenu=document.getElementById('audio-menu');
const audioToggle=document.getElementById('audio-toggle');
const volumeControls=document.getElementById('volume-controls');
const humSlider=document.getElementById('hum-volume');
const scrollSlider=document.getElementById('scroll-volume');
const focusSlider=document.getElementById('focus-volume');
const selectSlider=document.getElementById('select-volume');

audioToggle.addEventListener('click',()=>{
  volumeControls.style.display=volumeControls.style.display==='flex'?'none':'flex';
});

let humVolume=humSlider.value/10;
let scrollVolume=scrollSlider.value/10;
let focusVolume=focusSlider.value/10;
let selectVolume=selectSlider.value/10;
let fanHumBuffer,fanHumSource,fanHumGain;

humSlider.addEventListener('input',()=>{
  humVolume=humSlider.value/10;
  if(fanHumGain) fanHumGain.gain.value=humVolume;
});
scrollSlider.addEventListener('input',()=>{scrollVolume=scrollSlider.value/10;});
focusSlider.addEventListener('input',()=>{focusVolume=focusSlider.value/10;});
selectSlider.addEventListener('input',()=>{selectVolume=selectSlider.value/10;});

function updateInput(){
  input.innerHTML='&gt; '+inputText+'<span class="cursor">â–ˆ</span>';
}
updateInput();

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
fanHumGain=audioCtx.createGain();
fanHumGain.gain.value=humVolume;
fanHumGain.connect(audioCtx.destination);

let scrollBuffer;
let scrollTimeout;
let lastScrollTime=0;
const scrollIntervalMs=750;

async function loadScrollSound(){
  const res=await fetch('Terminal 3/charscroll_lp.wav');
  const buf=await res.arrayBuffer();
  scrollBuffer=await audioCtx.decodeAudioData(buf);
}

function playScrollSound(){
  if(!scrollBuffer) return;
  lastScrollTime=Date.now();
  const src=audioCtx.createBufferSource();
  src.buffer=scrollBuffer;
  const gain=audioCtx.createGain();
  gain.gain.value=scrollVolume;
  src.connect(gain).connect(audioCtx.destination);
  src.start();
  scrollTimeout=setTimeout(playScrollSound,scrollIntervalMs);
}
function startScrollSound(){
  if(scrollTimeout) return;
  const elapsed=Date.now()-lastScrollTime;
  if(elapsed>=scrollIntervalMs){
    playScrollSound();
  }else{
    scrollTimeout=setTimeout(playScrollSound,scrollIntervalMs-elapsed);
  }
}

function goBack(){
  if(screenHistory.length>1){
    screenHistory.pop();
    const prev=screenHistory.pop();
    showScreen(prev);
  }
}
function stopScrollSound(){
  if(!scrollTimeout) return;
  clearTimeout(scrollTimeout);
  scrollTimeout=null;
}

async function startFanHum(){
  if(!fanHumBuffer){
    const res=await fetch('Terminal 3/fanhum_lp.wav');
    const buf=await res.arrayBuffer();
    fanHumBuffer=await audioCtx.decodeAudioData(buf);
  }
  stopFanHum();
  fanHumSource=audioCtx.createBufferSource();
  fanHumSource.buffer=fanHumBuffer;
  fanHumSource.loop=true;
  fanHumSource.connect(fanHumGain);
  fanHumSource.start(0);
}

function stopFanHum(){
  if(fanHumSource){
    fanHumSource.stop();
    fanHumSource.disconnect();
    fanHumSource=null;
  }
}

function playFocusSound(){
  const audio=new Audio('Terminal 3/menu/menu_focus.wav');
  audio.volume=focusVolume;
  audio.play();
}

function playSelectSound(){
  const files=[
    'Terminal 4/HDD/HDD1/HDD101.wav',
    'Terminal 4/HDD/HDD1/HDD102.wav',
    'Terminal 4/HDD/HDD1/HDD103.wav',
    'Terminal 4/HDD/HDD1/HDD104.wav',
    'Terminal 4/HDD/HDD1/HDD105.wav',
    'Terminal 4/HDD/HDD1/HDD106.wav',
    'Terminal 4/HDD/HDD1/HDD107.wav',
    'Terminal 4/HDD/HDD1/HDD108.wav',
    'Terminal 4/HDD/HDD1/HDD109.wav',
    'Terminal 4/HDD/HDD1/HDD110.wav',
    'Terminal 4/HDD/HDD1/HDD111.wav',
    'Terminal 4/HDD/HDD1/HDD112.wav',
    'Terminal 4/HDD/HDD1/HDD113.wav',
    'Terminal 4/HDD/HDD1/HDD114.wav',
    'Terminal 4/HDD/HDD1/HDD115.wav'
  ];
  const enterFiles=[
    'Terminal 3/enter/charenter_01.wav',
    'Terminal 3/enter/charenter_02.wav',
    'Terminal 3/enter/charenter_03.wav'
  ];
  const hddSrc=files[Math.floor(Math.random()*files.length)];
  const enterSrc=enterFiles[Math.floor(Math.random()*enterFiles.length)];
  const hddAudio=new Audio(hddSrc);
  hddAudio.volume=selectVolume;
  hddAudio.play();
  const enterAudio=new Audio(enterSrc);
  enterAudio.volume=selectVolume;
  enterAudio.play();
}

function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

async function typeText(el,text){
  for(let ch of text){
    el.textContent+=ch;
    const delay=speed===Infinity?0:baseDelay/speed;
    if(delay>0) await sleep(delay);
  }
  el.textContent+='\n';
}

function waitForContinue(){
  return new Promise(res=>{
    function handler(e){
      if(e.type==='keydown'&&(e.key===' '||e.key==='Enter')){cleanup();}
      else if(e.type==='mousedown'&&e.button===0){cleanup();}
    }
    function cleanup(){
      document.removeEventListener('keydown',handler);
      document.removeEventListener('mousedown',handler);
      res();
    }
    document.addEventListener('keydown',handler);
    document.addEventListener('mousedown',handler);
  });
}

document.addEventListener('mousedown',e=>{
  if(!typing) return;
  if(e.button===0){
    speed=Infinity;
    skipNextClick=true;
    e.preventDefault();
  }
});
document.addEventListener('click',e=>{
  if(skipNextClick){
    e.preventDefault();
    e.stopPropagation();
    skipNextClick=false;
  }
},true);
document.addEventListener('keydown',e=>{
  if(!typing) return;
  if(e.key===' ') speed=1.5;
  else if(e.key==='Enter') speed=Infinity;
});

async function init(){
  startScrollSound();
  for(const line of headerLines){
    await typeText(header,line);
  }
  stopScrollSound();
  showScreen('menu');
}

async function showScreen(name){
  screenHistory.push(name);
  inputText='';
  updateInput();
  content.innerHTML='';
  currentOptions=[];
  selected=-1;
  const lines=screens[name];
  let i=0;
  while(i<lines.length){
    speed=1;
    typing=true;
    startScrollSound();
    while(i<lines.length){
      const line=lines[i];
      const div=document.createElement('div');
      content.appendChild(div);
      if(typeof line==='object'){
        div.className='option';
        div.tabIndex=0;
        await typeText(div,line.text);
        div.addEventListener('click',()=>{playSelectSound();showScreen(line.screen);});
        div.addEventListener('mouseenter',()=>{
          if(selected>=0){
            currentOptions[selected].classList.remove('selected');
            selected=-1;
          }
          playFocusSound();
        });
        currentOptions.push(div);
      }else{
        await typeText(div,line);
      }
      if(content.scrollHeight>content.clientHeight){
        content.removeChild(div);
        if(typeof line==='object') currentOptions.pop();
        typing=false;
        stopScrollSound();
        await waitForContinue();
        content.innerHTML='';
        currentOptions=[];
        selected=-1;
        break;
      }else{
        i++;
      }
    }
    if(typing){
      typing=false;
      stopScrollSound();
      if(i<lines.length){
        await waitForContinue();
        content.innerHTML='';
        currentOptions=[];
        selected=-1;
      }
    }
  }
}

document.addEventListener('keydown',e=>{
  if(typing || !currentOptions.length) return;
  if(e.key==='ArrowDown'){
    if(selected>=0) currentOptions[selected].classList.remove('selected');
    selected=selected<0?0:(selected+1)%currentOptions.length;
    currentOptions[selected].classList.add('selected');
    currentOptions[selected].focus();
    playFocusSound();
  }else if(e.key==='ArrowUp'){
    if(selected>=0) currentOptions[selected].classList.remove('selected');
    selected=selected<0?currentOptions.length-1:(selected-1+currentOptions.length)%currentOptions.length;
    currentOptions[selected].classList.add('selected');
    currentOptions[selected].focus();
    playFocusSound();
  }else if(e.key==='Enter' && selected>=0){
    currentOptions[selected].click();
  }
});

document.addEventListener('keydown',e=>{
  if(e.key==='Tab'){
    e.preventDefault();
    if(!typing) goBack();
    return;
  }
  if(typing) return;
  if(e.key==='Backspace'){
    inputText=inputText.slice(0,-1);
    updateInput();
    e.preventDefault();
  }else if(e.key.length===1 && !e.ctrlKey && !e.metaKey){
    inputText+=e.key;
    updateInput();
  }
});

powerButton.addEventListener('click',async()=>{
  await audioCtx.resume();
  if(!powered){
    const powerSound=new Audio('Terminal 3/poweron.mp3');
    powerSound.play();
    powerScreen.style.display='none';
    terminal.classList.add('powered');
    audioMenu.style.display='block';
    startFanHum();
    header.innerHTML='';
    content.innerHTML='';
    screenHistory=[];
    currentOptions=[];
    selected=-1;
    inputText='';
    updateInput();
    loadScrollSound().then(init);
    powered=true;
  }else{
    const powerSound=new Audio('Terminal 3/poweroff.mp3');
    powerSound.play();
    stopFanHum();
    stopScrollSound();
    powerScreen.style.display='flex';
    terminal.classList.remove('powered');
    audioMenu.style.display='none';
    volumeControls.style.display='none';
    powered=false;
  }
});
</script>
</body>
</html>
